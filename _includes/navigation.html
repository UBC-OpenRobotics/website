<nav class="bg-white dark:bg-gray-800 w-full border-b border-gray-200 dark:border-gray-700 fixed top-0 z-50 transition-colors duration-200 shadow-md dark:shadow-none" style="font-family: 'JetBrains Mono', sans-serif">
  <div class="max-w-screen-xl mx-auto px-4 md:px-8">
    <div class="flex items-center justify-between py-1">

      <!-- Logo -->
      <div class="flex items-center">
        <a href="/" class="flex items-center">
          <img src="/assets/logos/team/logo.png"
               alt="Open Robotics Logo"
               class="h-12 w-12 dark:hidden">
          <img src="/assets/logos/team/logo-dark.png"
               alt="Open Robotics Logo"
               class="h-12 w-12 hidden dark:block">
        </a>
      </div>

      <!-- Desktop nav links  -->
      <ul class="hidden md:flex md:space-x-8 md:absolute md:left-1/2 md:transform md:-translate-x-1/2">
        {% for item in site.data.navigation %}
        <li><a href="{{ item.link }}" class="text-gray-900 font-light dark:text-gray-100 hover:text-red-600 dark:hover:text-red-500 md:text-base transition-colors uppercase">{{ item.name }}</a></li>
        {% endfor %}
      </ul>

      <!-- Mobile menu button & location -->
      <div class="flex items-center space-x-4">

        <!-- Mobile menu button -->
        <button onclick="toggleMobileMenu()"
                class="md:hidden p-2 text-gray-900 dark:text-gray-100 hover:text-red-600 dark:hover:text-red-500 transition-colors"
                aria-label="Toggle menu">
          <span class="material-icons text-3xl">menu</span>
        </button>

        <!-- Accessibility icon -->
        <div class="relative" id="accessibilityDropdown">
          <button onclick="toggleAccessibilityDropdown()"
                  class="p-2 font-light text-gray-900 dark:text-gray-100 hover:text-red-600 dark:hover:text-red-500 transition-colors"
                  aria-label="Accessibility">
            <span class="material-icons text-3xl md:hidden">accessibility</span>
            <span class="hidden md:inline uppercase">ACCESSIBILITY</span>
          </button>

          <!-- Accessibility dropdown menu -->
          <div id="accessibilityMenu"
               class="hidden md:absolute md:right-0 md:mt-2 md:w-80 md:border md:border-gray-300 dark:md:border-gray-600 md:rounded-lg md:shadow-xl
                      fixed inset-0 md:inset-auto bg-white dark:bg-gray-800 z-50 transition-colors duration-200">
            <!-- Mobile header -->
            <div class="md:hidden flex items-center justify-between p-4 border-b-2 border-gray-200 dark:border-gray-700">
              <h3 class="text-xl font-bold text-gray-900 dark:text-gray-100">Accessibility</h3>
              <button onclick="toggleAccessibilityDropdown()" class="p-1 text-gray-900 dark:text-gray-100 hover:text-red-600 dark:hover:text-red-500">
                <span class="material-icons text-3xl">close</span>
              </button>
            </div>

            <div class="p-4 md:p-4">
              <!-- Desktop header -->
              <h3 class="hidden md:block text-lg font-bold text-gray-900 dark:text-gray-100 mb-2">Accessibility</h3>

              <!-- Animation toggle option -->
              <div class="mt-4 md:mt-3">
                <div class="flex items-center justify-between p-3 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">
                  <div class="flex items-center space-x-3">
                    <span class="material-icons text-gray-700 dark:text-gray-300">animation</span>
                    <div>
                      <p class="text-sm font-semibold text-gray-900 dark:text-gray-100">Animations</p>
                      <p class="text-xs text-gray-600 dark:text-gray-400">Enable or disable animations</p>
                    </div>
                  </div>
                  <button id="animationToggle"
                          onclick="toggleAnimations()"
                          class="relative inline-flex h-6 w-11 items-center rounded-full transition-colors focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 bg-red-600"
                          role="switch"
                          aria-checked="true">
                    <span id="animationToggleSwitch" class="inline-block h-4 w-4 transform rounded-full bg-white transition-transform translate-x-6"></span>
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- Mobile Backdrop overlay -->
          <div id="accessibilityBackdrop"
               class="hidden fixed inset-0 bg-black bg-opacity-50 z-40 md:hidden"
               onclick="toggleAccessibilityDropdown()">
          </div>
        </div>

        <!-- Map pin icon -->
        <div class="relative" id="locationDropdown">
          <button onclick="toggleLocationDropdown()"
          class="p-2 text-gray-900 dark:text-gray-100 hover:text-red-600 dark:hover:text-red-500 transition-colors"
          aria-label="Location">
          <span class="material-icons text-3xl">location_on</span>
        </button>

          <!-- Desktop dropdown menu -->
          <div id="dropdownMenu"
               class="hidden md:absolute md:right-0 md:mt-2 md:w-80 md:border md:border-gray-300 dark:md:border-gray-600 md:rounded-lg md:shadow-xl
                      fixed inset-0 md:inset-auto bg-white dark:bg-gray-800 z-50 transition-colors duration-200">
            <!-- Mobile header -->
            <div class="md:hidden flex items-center justify-between p-4 border-b-2 border-gray-200 dark:border-gray-700">
              <h3 class="text-xl font-bold text-gray-900 dark:text-gray-100">Our Location</h3>
              <button onclick="toggleLocationDropdown()" class="p-1 text-gray-900 dark:text-gray-100 hover:text-red-600 dark:hover:text-red-500">
                <span class="material-icons text-3xl">close</span>
              </button>
            </div>

            <div class="p-4 md:p-4">
              <!-- Desktop header, which is hidden for mobile -->
              <h3 class="hidden md:block text-lg font-bold text-gray-900 dark:text-gray-100 mb-2">Our Location</h3>

              <p class="text-sm md:text-sm text-gray-700 dark:text-gray-300 mb-3 mt-4 md:mt-0">
                <strong>{{ site.data.info.location.building }}</strong><br>
                {{ site.data.info.location.address }}<br>
                {{ site.data.info.location.city }}, {{ site.data.info.location.province }} {{ site.data.info.location.postal-code }}
              </p>

              <div class="w-full h-64 md:h-48 rounded-md overflow-hidden">
                <iframe
                  src="{{ site.data.info.location.google-maps-embedded-iframe-link }}"
                  width="100%"
                  height="100%"
                  style="border:0;"
                  allowfullscreen=""
                  loading="lazy"
                  referrerpolicy="no-referrer-when-downgrade">
                </iframe>
              </div>

              <a href="https://maps.app.goo.gl/PDkgJSt9E2Qph4Em9"
                 target="_blank"
                 class="mt-4 md:mt-3 block text-center py-3 md:py-2 px-4 bg-red-600 hover:bg-red-700 text-white font-semibold rounded-md transition-colors">
                Open in Google Maps
              </a>
            </div>
          </div>

          <!-- Mobile Backdrop overlay -->
          <div id="modalBackdrop"
               class="hidden fixed inset-0 bg-black bg-opacity-50 z-40 md:hidden"
               onclick="toggleLocationDropdown()">
          </div>
        </div>

        <!-- Sponsor  -->
        <!-- <a href="https://donate.support.ubc.ca/page/20924/donate/1?transaction.dirgift=Open+Robotics+Student+Team%20G1102"
           class="py-2 px-4 border-2 border-red-600 hover:bg-red-600 text-red-600 hover:text-white font-bold rounded-md transition-colors uppercase">
          Sponsor
        </a> -->
      </div>

    </div>
  </div>

  <!-- Mobile menu panel -->
  <div id="mobileMenu" class="hidden md:hidden bg-white dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700">
    <ul class="flex flex-col px-4 py-4 space-y-4">
      {% for item in site.data.navigation %}
      <li><a href="{{ item.link }}"
             onclick="toggleMobileMenu()"
             class="block text-gray-900 font-light dark:text-gray-100 hover:text-red-600 dark:hover:text-red-500 text-lg transition-colors uppercase">{{ item.name }}</a></li>
      {% endfor %}

      <!-- Accessibility option in mobile menu -->
      <li class="pt-4 border-t border-gray-200 dark:border-gray-700">
        <div class="flex items-center justify-between py-2">
          <div class="flex items-center space-x-3">
            <span class="material-icons text-gray-700 dark:text-gray-300">animation</span>
            <span class="text-gray-900 font-light dark:text-gray-100 text-lg">Animations</span>
          </div>
          <button id="animationToggleMobile"
                  onclick="toggleAnimations()"
                  class="relative inline-flex h-6 w-11 items-center rounded-full transition-colors focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 bg-red-600"
                  role="switch"
                  aria-checked="true">
            <span id="animationToggleSwitchMobile" class="inline-block h-4 w-4 transform rounded-full bg-white transition-transform translate-x-6"></span>
          </button>
        </div>
      </li>
    </ul>
  </div>
</nav>

<script>
  function toggleMobileMenu() {
    const mobileMenu = document.getElementById('mobileMenu');
    mobileMenu.classList.toggle('hidden');
  }

  function toggleLocationDropdown() {
    const dropdown = document.getElementById('dropdownMenu');
    const backdrop = document.getElementById('modalBackdrop');
    const isHidden = dropdown.classList.contains('hidden');

    if (isHidden) {
      // Open modal
      dropdown.classList.remove('hidden');
      backdrop.classList.remove('hidden');
      // Prevent body scroll on mobile when modal is open
      if (window.innerWidth < 768) {
        document.body.style.overflow = 'hidden';
      }
    } else {
      // Close modal
      dropdown.classList.add('hidden');
      backdrop.classList.add('hidden');
      document.body.style.overflow = '';
    }
  }

  // Close dropdown when clicking outside (desktop only)
  document.addEventListener('click', function(event) {
    const locationDropdown = document.getElementById('locationDropdown');
    const dropdownMenu = document.getElementById('dropdownMenu');
    const backdrop = document.getElementById('modalBackdrop');

    // Only close if clicking outside on desktop
    if (window.innerWidth >= 768 && locationDropdown && !locationDropdown.contains(event.target)) {
      dropdownMenu.classList.add('hidden');
      backdrop.classList.add('hidden');
      document.body.style.overflow = '';
    }
  });

  // Re-enable body scroll if window is resized
  window.addEventListener('resize', function() {
    const dropdown = document.getElementById('dropdownMenu');
    if (!dropdown.classList.contains('hidden') && window.innerWidth >= 768) {
      document.body.style.overflow = '';
    }
  });

  // Accessibility dropdown toggle
  function toggleAccessibilityDropdown() {
    const dropdown = document.getElementById('accessibilityMenu');
    const backdrop = document.getElementById('accessibilityBackdrop');
    const isHidden = dropdown.classList.contains('hidden');

    if (isHidden) {
      // Open modal
      dropdown.classList.remove('hidden');
      backdrop.classList.remove('hidden');
      // Prevent body scroll on mobile when modal is open
      if (window.innerWidth < 768) {
        document.body.style.overflow = 'hidden';
      }
    } else {
      // Close modal
      dropdown.classList.add('hidden');
      backdrop.classList.add('hidden');
      document.body.style.overflow = '';
    }
  }

  // Close accessibility dropdown when clicking outside (desktop only)
  document.addEventListener('click', function(event) {
    const accessibilityDropdown = document.getElementById('accessibilityDropdown');
    const accessibilityMenu = document.getElementById('accessibilityMenu');
    const accessibilityBackdrop = document.getElementById('accessibilityBackdrop');

    // Only close if clicking outside on desktop
    if (window.innerWidth >= 768 && accessibilityDropdown && !accessibilityDropdown.contains(event.target)) {
      accessibilityMenu.classList.add('hidden');
      accessibilityBackdrop.classList.add('hidden');
      document.body.style.overflow = '';
    }
  });

  // Animation toggle functionality
  function toggleAnimations() {
    const animationsEnabled = localStorage.getItem('animationsEnabled') !== 'false';
    const newState = !animationsEnabled;

    localStorage.setItem('animationsEnabled', newState.toString());
    updateAnimationState(newState);
  }

  function updateAnimationState(enabled) {
    const toggle = document.getElementById('animationToggle');
    const toggleSwitch = document.getElementById('animationToggleSwitch');
    const toggleMobile = document.getElementById('animationToggleMobile');
    const toggleSwitchMobile = document.getElementById('animationToggleSwitchMobile');
    const html = document.documentElement;

    if (enabled) {
      // Desktop toggle
      if (toggle) {
        toggle.classList.remove('bg-gray-400');
        toggle.classList.add('bg-red-600');
        toggle.setAttribute('aria-checked', 'true');
      }
      if (toggleSwitch) {
        toggleSwitch.classList.add('translate-x-6');
        toggleSwitch.classList.remove('translate-x-1');
      }

      // Mobile toggle
      if (toggleMobile) {
        toggleMobile.classList.remove('bg-gray-400');
        toggleMobile.classList.add('bg-red-600');
        toggleMobile.setAttribute('aria-checked', 'true');
      }
      if (toggleSwitchMobile) {
        toggleSwitchMobile.classList.add('translate-x-6');
        toggleSwitchMobile.classList.remove('translate-x-1');
      }

      html.classList.remove('reduce-motion');
    } else {
      // Desktop toggle
      if (toggle) {
        toggle.classList.remove('bg-red-600');
        toggle.classList.add('bg-gray-400');
        toggle.setAttribute('aria-checked', 'false');
      }
      if (toggleSwitch) {
        toggleSwitch.classList.remove('translate-x-6');
        toggleSwitch.classList.add('translate-x-1');
      }

      // Mobile toggle
      if (toggleMobile) {
        toggleMobile.classList.remove('bg-red-600');
        toggleMobile.classList.add('bg-gray-400');
        toggleMobile.setAttribute('aria-checked', 'false');
      }
      if (toggleSwitchMobile) {
        toggleSwitchMobile.classList.remove('translate-x-6');
        toggleSwitchMobile.classList.add('translate-x-1');
      }

      html.classList.add('reduce-motion');
    }
  }

  // Initialize animation state on page load
  (function initAnimations() {
    const animationsEnabled = localStorage.getItem('animationsEnabled') !== 'false';
    updateAnimationState(animationsEnabled);
  })();
</script>